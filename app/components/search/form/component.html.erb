<div data-controller="search--form">
  <%= form_with(url: @target_search_path,
      builder: BikeIndexFormBuilder,
      method: :get,
      id: "Search_Form",
      data: { turbo_frame: @target_frame, turbo_action: "advance",
        turbo: true, "search--form-target" => "form"}) do |f| %>
    <%# search_no_js is removed in the search--form stimulus controller. If it's present, the results render synchronously (rather than as a turbo frame) %>
    <%= hidden_field_tag :search_no_js, true %>

    <div class="tw:flex tw:flex-nowrap tw:gap-4">
      <div class="search-fields tw:flex-grow">
        <%= render(
          Search::EverythingCombobox::Component.new(
            selected_query_items_options: @selected_query_items_options,
            query:,
          ),
        ) %>

        <% if render_serial_field? %>
          <%= label_tag :serial,
          translation(".search_for_serial_number"),
          class: "twlabel tw:sr-only" %>
          <%= text_field_tag :serial,
          serial_value,
          placeholder: translation(".search_for_serial_number"),
          class: "twinput tw:mt-2 fieldResetsCounts" %>
        <% end %>

        <% if render_activity_and_price_wrapper? %>
          <div
            class="
              tw:mt-2 tw:flex tw:flex-wrap tw:justify-between tw:gap-3
              tw:md:flex-nowrap
            "
          >
            <% if render_primary_activity_field? %>
              <%= label_tag :primary_activity,
              translation(".search_for_primary_activity"),
              class: "twlabel tw:sr-only" %>
              <%= select_tag :primary_activity,
              primary_activity_select_opts,
              prompt: translation(".search_for_primary_activity"),
              class: "twinput tw:md:max-w-xl fieldResetsCounts" %>
            <% end %>

            <% if render_price_field? %>
              <span class="tw:flex tw:max-w-60 tw:flex-nowrap">
                <%# NOTE: This isn't used yet, including it because it will be someday! %>
                <%= hidden_field_tag :currency, @currency_sym %>

                <span class="tw:mr-1 tw:block tw:py-1.5">
                  <%= @currency_sym %>
                </span>

                <%= label_tag :price_min_amount,
                translation(".price_minimum"),
                class: "twlabel tw:sr-only" %>

                <%= number_field_tag :price_min_amount,
                @price_min_amount,
                placeholder: translation(".min"),
                class: "twinput tw:min-w-20 fieldResetsCounts" %>

                <span class="tw:mr-1 tw:ml-2 tw:block tw:min-w-6 tw:py-1.5">
                  &ndash; <%= @currency_sym %>
                </span>

                <%= label_tag :price_max_amount,
                translation(".price_maximum"),
                class: "twlabel tw:sr-only" %>

                <%= number_field_tag :price_max_amount,
                @price_max_amount,
                placeholder: translation(".max"),
                class: "twinput tw:min-w-20 fieldResetsCounts" %>
              </span>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="tw:w-20">
        <%= button_tag(type: translation(".submit"),
            class: "twbtn-blue tw:w-full tw:h-full tw:disabled:cursor-wait",
            "data-search--form-target" => "button") do %>
          <%= helpers.inline_svg_tag "icons/searcher.svg",
            id: "search-button",
            class: "tw:text-white",
            title: "searcher" %>
        <% end %>
      </div>
    </div>

    <% if render_serial_field? && serial_looks_like_not_a_serial? %>
      <%= render(
        UI::Alert::Component.new(
          text: translation(".doesnt_look_like_serial"),
          kind: :warning,
          margin_classes: "tw:my-2",
        ),
      ) %>
    <% end %>

    <%= render(Search::KindSelectFields::Component.new(**kind_select_options)) %>

    <%= if render_result_view?
      render(Search::ResultViewSelect::Component.new(result_view: @result_view))
    end %>
  <% end %>
</div>
