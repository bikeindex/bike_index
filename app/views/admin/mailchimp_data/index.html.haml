.admin-subnav
  .col-md-5
    %h1
      Mailchimp Values
  .col-md-7
    %ul
      / %li.nav-item
      /   = link_to "update values", admin_mailchimp_values_path, action: :create, method: :post, class: "nav-link"
      %li.nav-item
        %a.nav-link{ href: ".data-cell-collapsed", "aria-expanded" => "false", "data-toggle" => "collapse"}
          Toggle data
      %li.nav-item
        = link_to "graph", admin_mailchimp_data_path(sortable_search_params.merge(render_chart: !@render_chart)), class: "nav-link #{@render_chart ? 'active' : ''}"

.row.mt-4.mb-4
  .col-sm-6
    = number_with_delimiter(@mailchimp_data.total_count)
    matching Mailchimp Data
    %em
      = humanized_time_range_column(@time_range_column)
      = humanized_time_range(@time_range)

- if @render_chart
  = column_chart time_range_counts(collection: matching_mailchimp_data), stacked: true, thousands: ",", defer: true

.mt-4.mb-4
  = render partial: "/shared/period_select"

= paginate @mailchimp_data, views_prefix: "admin"

%table.table.table-striped.table-bordered.table-sm.without-exterior-border#recordsTable
  %thead.small-header.hidden-md-down
    %th
      Email
    %th
      Feedbacks
    %th
      = sortable "created_at"
    %th.small
      = sortable "updated_at"
    %th
      Lists
    %th
      = sortable "mailchimp_updated_at"
    %th.collapse.data-cell-collapsed Data

  %tbody
    - @mailchimp_data.each do |mailchimp_datum|
      %tr
        %td
          - if mailchimp_datum.user.present?
            = link_to mailchimp_datum.email, admin_user_path(mailchimp_datum.user)
          - else
            = mailchimp_datum.email
        %td
          = safe_join(mailchimp_datum.feedbacks.map { |f| link_to(f.humanized_kind, admin_feedback_path(f), class: "small") }, ", ")
        %td
          %span.convertTime
            = l(mailchimp_datum.created_at, format: :convert_time)
        %td
          %small.convertTime
            = l(mailchimp_datum.updated_at, format: :convert_time)
        %td
          = mailchimp_datum.lists.join(", ")
        %td
          %span.convertTime
            = l(mailchimp_datum.mailchimp_updated_at, format: :convert_time)
        %td.collapse.data-cell.data-cell-collapsed.small
          = pretty_print_json(mailchimp_datum.data)
