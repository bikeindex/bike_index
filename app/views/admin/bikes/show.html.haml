= render partial: "/admin/bikes/bike_tabs", locals: {bike: @bike, active_tab: "bikes-#{@active_tab}", display_recovery: @active_tab == "recoveries" }

%h1.mt-5.mb-4
  = @active_tab.titleize

- if @active_tab == "ownerships"
  .full-screen-table.mt-4
    %table.table.table-striped.table-bordered.table-sm
      %thead.thead-light
        %th
          Created&nbsp;<small class="convertTimezone"></small>
        %th
          Creator
        %th
          Owner email
        %th
          Current?
        %th
          Claimed?
        %th.d-none.d-md-table-cell
          User hidden
      %tbody
        - @bike.ownerships.reorder(created_at: :desc).each do |ownership|
          %tr
            %td
              %a.convertTime{ href: edit_admin_ownership_url(ownership.id) }
                = l ownership.created_at, format: :convert_time
              - if display_dev_info?
                %small.less-strong.only-dev-visible
                  = ownership.id
            %td
              - creator = ownership.creator
              - if creator.blank?
                %em.text-warning user deleted
                - if display_dev_info?
                  %span.only-dev-visible
                    \##{ownership.creator_id}
              - elsif creator.name.present?
                = creator.name
              - else
                = creator.email
            %td
              = ownership.owner_email
            %td.table-cell-check
              = check_mark if ownership.current
            %td.table-cell-check
              = check_mark if ownership.claimed
            %td.table-cell-check.d-none.d-md-table-cell
              = check_mark if ownership.user_hidden

- elsif @active_tab == "stickers"
  = render partial: "/admin/bike_stickers/table", locals: {bike_stickers: @bike.bike_stickers}



- elsif @active_tab == "messages"
  %h3.mt-4
    Notifications
    %small.less-strong
      = link_to admin_number_display(@bike.notifications.count), admin_notifications_path(search_bike_id: @bike.id)
  - if @bike.notifications.any?
    .mt-2
      = render partial: "/admin/notifications/table", locals: {notifications: @bike.notifications.order(created_at: :desc), skip_bike: true}
    .mb-4

  - feedbacks = Feedback.bike(@bike.id).order(created_at: :desc)
  %h3.mt-3
    Feedbacks
    %small.less-strong
      = link_to admin_number_display(feedbacks.count), admin_feedbacks_path(search_bike_id: @bike.id)

  - if feedbacks.any?
    .mt-2
    = render partial: "/admin/feedbacks/table", locals: {feedbacks: feedbacks, skip_bike: true}
    .mb-4

  - user_alerts = UserAlert.where(bike_id: @bike.id).order(created_at: :desc)
  %h3.mt-3
    User Alerts
    %small.less-strong
      = link_to admin_number_display(user_alerts.count), admin_user_alerts_path(search_bike_id: @bike.id)
  - if user_alerts.any?
    .mt-2
    = render partial: "/admin/user_alerts/table", locals: {user_alerts: user_alerts}
    .mb-4

  - parking_notifications = @bike.parking_notifications.order(created_at: :desc)
  %h3.mt-3
    Parking Notifications
    %small.less-strong
      = link_to admin_number_display(parking_notifications.count), admin_parking_notifications_path(search_bike_id: @bike.id)
  - if parking_notifications.any?
    .mt-2
    = render partial: "/admin/parking_notifications/table", locals: {parking_notifications: parking_notifications}
    .mb-4

  - parking_notifications = @bike.parking_notifications.order(created_at: :desc)
  %h3.mt-3
    Graduated Notifications
    %strong
      = link_to admin_number_display(@bike.graduated_notifications.count), admin_graduated_notifications_path(search_bike_id: @bike.id)

- elsif @active_tab == "recoveries"
  = render partial: "/admin/recoveries/table", locals: {recoveries: @bike.recovered_records, skip_bike: true}

  %h3 Other stolen records
  - if @bike.stolen_records.none?
    No other stolen records
  - else
    %ul
      - @bike.stolen_records.each do |stolen_record|
        %li
          Stolen on
          %a.convertTime{href: edit_admin_stolen_bike_url(stolen_record, stolen_record_id: true)}
            = l stolen_record.date_stolen, format: :convert_time

- elsif @active_tab == "impound"

  %h3.mt-4
    Impound records for this bike
    %small.less-strong
      = link_to admin_number_display(@bike.impound_records.count), admin_impound_records_path(search_bike_id: @bike.id)
  = render partial: "/admin/impound_records/table", locals: {impound_records: @bike.impound_records.reorder(created_at: :desc), skip_claims: true}

  - impound_claims = ImpoundClaim.involving_bike_id(@bike.id).reorder(created_at: :desc)
  %h3.mt-4
    Impound claims involving this bike
    %small.less-strong
      = link_to admin_number_display(impound_claims.count), admin_impound_claims_path(search_bike_id: @bike.id)

  = render partial: "/admin/impound_claims/table", locals: {impound_claims: impound_claims}
