.admin-subnav
  .col-5
    %h1
      Manage Failed Bikes
  .col-7
    %ul
      %li.nav-item
        = link_to "graph", admin_failed_bikes_path(sortable_search_params.merge(render_chart: !@render_chart)), class: "nav-link #{@render_chart ? 'active' : ''}"

- if @render_chart
  = column_chart time_range_counts(collection: matching_b_params), stacked: true, thousands: ",", defer: true

.mt-4
  = render partial: "/shared/period_select"

%p.mt-4
  = number_with_delimiter(matching_b_params.count, delimiter: ',')
  failed bikes
  %em
    #{humanized_time_range(@time_range)},
  %strong
    = number_with_delimiter(matching_b_params.where("created_at > ?", Time.current - 24.hours).count)
  today

.full-screen-table.mt-4
  %table.table.table-striped.table-bordered.table-sm
    %thead.thead-light.sortable
      %th
        = sortable "created_at"
      %th.small
        = sortable "updated_at"
      %th
        = sortable "email"
      %th
        Errors
    %tbody
      - @b_params.each do |b_param|
        %tr
          %td
            %a.convertTime.preciseTime{ href: admin_failed_bike_url(b_param.id) }
              = l b_param.created_at, format: :convert_time
          %td
            %small.convertTime.preciseTime
              = l b_param.updated_at, format: :convert_time
          %td
            = b_param.creator.email if b_param.creator
          %td
            - if b_param.bike_errors.present?
              = b_param.bike_errors.each { |f| f.to_s.humanize}
            - if b_param.errors.present?
              = b_param.errors.each_key { |f| f.to_s.humanize}
            / - if b_param.params.creation_organization_id && b_param.params.creation_organization_id
            /   - organization = Organization.find(b_param.params.creation_organization_id)
            /   = organization.name

.paginate-container
  = paginate @b_params
