.row
  .col-md-6
    %h1
      Editing #{@user.email}
    %table.table-list
      %tbody
        %tr
          %td
            Donor
          %td
            - if @user.donor?
              <span class="donor-icon">D</span>
            - if @user.paid_org?
              <span class="paid-org-icon">O</span>
        %tr
          %td
            Email: Newsletters
          %td
            = "&#x2713;".html_safe if @user.notification_newsletters
        %tr
          %td
            Email: Unstolen
          %td
            = "&#x2713;".html_safe if @user.notification_unstolen
        %tr
          %td
            Created
          %td.convertTime
            = l @user.created_at, format: :convert_time
        %tr
          %td
            Updated
          %td.convertTime
            = l @user.updated_at, format: :convert_time
  .col-md-6.mt-auto
    .card
      .card-body.bg-light{style: "overflow-y: scroll; height: 200px;"}
        - if @bikes.present?
          .row
            .col-auto
              %h3.mt-4
                %span
                  #{@user.email}
                Bikes (#{pluralize(@bikes.total_count, "Bike")})
          %ul.list-unstyled
            - @bikes.decorate.each do |bike|
              - display = bike.title
              - display = "#{display} (hidden)" if bike.hidden
              - display = "#{display} (example)" if bike.example

              %li
                = link_to display, edit_admin_bike_url(bike)
= form_for [:admin, @user] do |f|
  - if @user.errors.any?
    = render partial: "/shared/errors", locals: { name: "User", obj: @user }
  .row.mt-4
    .col-md-6
      .form-group
        = f.label :name
        = f.text_field :name, class: "form-control"
    .col-md-6
      .form-group
        = f.label :email
        = f.email_field :email, class: "form-control"
  .row
    .col-md-6
      .form-group
        = f.label :username
        = f.text_field :username
      .form-check.form-check-inline
        = f.label :confirmed, class: "form-check-label"
        = f.check_box :confirmed, disabled: @user.confirmed, class: "form-check-input"
      .form-check.form-check-inline
        = f.label :superuser, class: "form-check-label"
        = f.check_box :superuser, class: "form-check-input"
      - if current_user.developer?
        .form-check.form-check-inline
          = f.label :developer, class: "form-check-label"
          = f.check_box :developer, class: "form-check-input"
      .form-check.form-check-inline
        = f.label :banned, class: "form-check-label"
        = f.check_box :banned, class: "form-check-input"
      .form-check.form-check-inline
        = f.label :can_send_many_stolen_notifications, class: "form-check-label"
        = f.check_box :can_send_many_stolen_notifications, class: "form-check-input"
    .col-md-6
      .form-group
        = f.label :secondary_emails
        = text_area_tag :secondary_emails, @user.secondary_emails.join(", "), disabled: true, rows: 2, class: "form-control"



  .row.justify-content-end.mt-4
    .col-auto
      = f.submit 'Save', class: 'btn btn-success'



%h3
  Donations
.full-screen-table
  %table.table.table-striped.table-bordered
    %thead.thead-light
      %th
        Date
      %th
        Amount
      %th
        Payment?
    - @user.payments.reorder(created_at: :desc).each do |payment|
      %tr
        %td
          %span.convertTime
            = l payment.created_at, format: :convert_time
          %small.convertTimezone
        %td
          = payment.amount
        %td
          = "&#x2713;".html_safe if payment.is_payment
- if @ownerships.present?
  .row
    .col-auto
      %h3.mt-4
        %span
          #{@user.email}
        ownerships(#{pluralize(@ownerships.total_count, "Ownership")})
  .full-screen-table
    %table.table.table-striped.table-bordered.table-sm
      %thead.thead-light
        %th
          ID
        %th
          Created&nbsp;<small class="convertTimezone"></small>
        %th
          Creator
        %th
          Owner email
        %th
          Current?
      %tbody
        - @ownerships.each do |ownership|
          %tr
            %td
              = link_to ownership.id, edit_admin_ownership_url(ownership.id)
            %td
              %span.convertTime
                = l ownership.created_at, format: :convert_time
            %td
              - u = ownership.creator
              - if u && u.name.present?
                = u.name
              - else
                = u && u.email
            %td
              = ownership.owner_email
            %td.table-cell-check
              = "&#x2713;".html_safe if ownership.current
  = paginate @ownerships
- else
  %p
    #{@user.email} has no Bikes

- if @user.memberships.count > 0
  .full-screen-table
    %h2
      = @user.memberships.count
      Current memberships
    %table#admin-users-table.table.table-striped.table-bordered
      %thead.thead-light
        %th
          Id&nbsp;
        %th.d-none.d-lg-table-cell
          Created&nbsp;<small class="convertTimezone"></small>
        %th
          Email
        %th
          Organization
        %th.d-none.d-xl-table-cell
          Management links
      %tbody
        - @user.memberships.each do |membership|
          %tr
            %td
              = link_to membership.id, admin_membership_url(membership)
            %td.d-none.d-lg-table-cell
              %span.convertTime
                = l membership.created_at, format: :convert_time
            %td
              = membership.user.email
            %td
              = link_to membership.organization.name, admin_organization_path(membership.organization)
            %td.d-none.d-xl-table-cell
              #{link_to 'Edit', edit_admin_membership_url(membership)}

- if @user.user_emails.count > 1
  %h2 User emails
  .full-screen-table
    %table.table.table-striped.table-bordered
      %thead
        %th
          Created&nbsp;<small class="convertTimezone"></small>
        %th
          Confirmed
        %th
          Primary
        %th
          Old User Id
      %tbody
        - @user.user_emails.each do |user_email|
          %tr
            %td
              .less-strong-hold
                %span.less-strong-right.medium-screens
                  = user_email.id
              %span.convertTime
                = l user_email.created_at, format: :convert_time
            %td
              = "&#x2713;".html_safe if user_email.confirmed
            %td
              = "&#x2713;".html_safe if user_email.primary
            %td
              = user_email.old_user_id

.mt-4.mb-4.row.justify-content-end
  .col-auto
    = link_to "Delete #{@user.email}!", admin_user_url(@user), method: :delete, confirm: "Are you sure?", class: "btn btn-danger"
