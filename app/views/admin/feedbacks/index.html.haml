.admin-subnav
  .col-12
    %h1
      #{link_to 'Feedback and messages', admin_feedbacks_path}
  .col-12.mt-4
    = line_chart graphs_admin_feedbacks_path(params.merge(start_at: params[:start_at]).except(:controller, :action))
  .col-12.mt-2
    .d-flex
      %ul.list-inline.mx-auto.justify-content-center
        - %w(all_time past_year past_month past_week).each do |start_at|
          %li.list-inline-item
            = link_to start_at.humanize, admin_feedbacks_path(params.merge(start_at: start_at).except(:controller, :action))


%p
  - if @matching_count.present?
    = number_with_delimiter(@matching_count)
    %strong
      = params[:type]
    messages
  - else
    = number_with_delimiter(@feedbacks.total_count)
    total messages


= paginate @feedbacks, views_prefix: 'admin'

.full-screen-table
  %table.table.table-bordered.table-striped
    %thead.thead-light
      %tr
        %th.w-25{:scope => "col"} Created
        %th{:scope => "col"} User
        %th{:scope => "col"} Type
        %th{:scope => "col"} Name
        %th.w-25{:scope => "col"} Body
    %tbody
      - @feedbacks.each do |feedback|
        %tr
          %td
            %a.convertTime{ href: admin_feedback_url(feedback) }
              = l feedback.created_at, format: :convert_time
          %td
            - if feedback.user
              = link_to feedback.user.display_name, edit_admin_user_path(feedback.user)
            - else
              = link_to feedback.email, admin_users_path(user_query: feedback.email)
          %td
            - feedback_type = feedback.feedback_type || 'msg'
            = link_to feedback_type, admin_feedbacks_path(type: feedback_type)
          %td
            = feedback.name
          %td
            = feedback.body.truncate(100)

= paginate @feedbacks, views_prefix: 'admin'
