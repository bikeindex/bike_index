<%# locals: (collection:, render_sortable: false) %>

<div class="full-screen-table">
  <table class="table table-striped table-bordered table-sm">
    <thead class="thead-light">
      <th><%= sortable "created_at", render_sortable: render_sortable %></th>

      <th>
        <small>
          <%= sortable "updated_at", render_sortable: render_sortable %>
        </small>
      </th>

      <th>
        <%= sortable "user_id", "User", render_sortable: render_sortable %>
      </th>

      <th><%= sortable "status", render_sortable: render_sortable %></th>

      <th>Athlete ID</th>

      <th>
        <%= sortable "activities_downloaded_count", "Activities", render_sortable: render_sortable %>
      </th>

      <th>Gear</th>

      <th>
        <%= sortable "last_updated_activities_at", "Activities updated", render_sortable: render_sortable %>
      </th>

      <th><%= sortable "deleted_at", render_sortable: render_sortable %></th>
    </thead>

    <tbody>
      <% collection.each do |strava_integration| %>
        <tr>
          <td>
            <div class="less-strong-hold">
              <%= link_to admin_strava_integration_path(strava_integration), class: "localizeTime" do %>
                <%= l strava_integration.created_at, format: :convert_time %>
              <% end %>

              <% if display_dev_info? %>
                <span class="less-strong-right d-none d-md-block only-dev-visible">
                  <%= strava_integration.id %>
                </span>
              <% end %>
            </div>
          </td>

          <td>
            <small class="localizeTime">
              <%= l strava_integration.updated_at, format: :convert_time %>
            </small>
          </td>

          <td>
            <%= render Admin::UserCell::Component.new(user: strava_integration.user, user_id: strava_integration.user_id, render_search: render_sortable) %>
          </td>

          <td>
            <%# duplicated in strava_integrations/show %>
            <% if strava_integration.synced? %>
              <span class="text-success"><%= strava_integration.status %></span>
            <% elsif strava_integration.error? %>
              <span class="text-danger"><%= strava_integration.status %></span>
            <% else %>
              <small><%= strava_integration.status %></small>
            <% end %>

            <% if strava_integration.permissions_less? %>
              <%= render UI::Badge::Component.new(text: "p-", title: "less than default permissions", color: :error, size: :sm) %>
            <% elsif strava_integration.permissions_more? %>
              <%= render UI::Badge::Component.new(text: "p+", title: "more than default permissions", color: :notice, size: :sm) %>
            <% end %>
          </td>

          <td><small><%= strava_integration.athlete_id %></small></td>

          <td><%= strava_integration.activities_downloaded_count %></td>

          <td>
            <small>
              <%= strava_integration.gear_names.join(", ").truncate(40) %>
            </small>
          </td>

          <td>
            <% if strava_integration.last_updated_activities_at.present? %>
              <small class="localizeTime">
                <%= l strava_integration.last_updated_activities_at, format: :convert_time %>
              </small>
            <% end %>
          </td>

          <td>
            <% if strava_integration.deleted_at.present? %>
              <small class="localizeTime text-danger">
                <%= l strava_integration.deleted_at, format: :convert_time %>
              </small>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
