%h1.text-center
  Go Hard

%h2.mb-4.mt-4
  Recent
  = link_to "Bikes", admin_bikes_url

= render partial: "/admin/bikes/table", locals: { bikes: @bikes }

:ruby
  today_time = Time.current.beginning_of_day
  yesterday_time = today_time - 1.day
  today = Bike.where("created_at >= ?", today_time).count
  yesterday = (Bike.where("created_at >= ?", yesterday_time).count) - today
  bikes = [
    { name: 'Registrations', data: Bike.unscoped.current.non_stolen.where(created_at: @time_range).send(group_by_method(@time_range), "bikes.created_at", range: @time_range, format: group_by_format(@time_range)).count },
    { name: 'Stolen', data: Bike.unscoped.current.stolen.where(created_at: @time_range).send(group_by_method(@time_range), "bikes.created_at", range: @time_range, format: group_by_format(@time_range)).count }
  ]

%table.table-list
  %tr
    %td Today
    %td
      %span.convertTime
        = l today_time, format: :convert_time
  %tr
    %td Today
    %td
      %span.convertTime
        = l yesterday_time, format: :convert_time
  %tr
    %td Range first
    %td
      %span.convertTime
        = l @time_range.first, format: :convert_time
  %tr
    %td Range last
    %td
      %span.convertTime
        = l @time_range.last, format: :convert_time


.row.justify-content-end
  .col-auto
    %p
      = number_with_delimiter(Bike.count)
      bikes total
      %em

        (#{number_with_delimiter(today)} today, #{number_with_delimiter(yesterday)} yesterday)

= column_chart bikes, stacked: true, thousands: ",", defer: true

%hr

%h2.mt-4
  Recent
  = link_to "Users", admin_users_url
= render partial: "/admin/users/table"
.row.justify-content-end
  .col-auto
    %p
      = number_with_delimiter(User.count)
      users total
      - today = User.where("created_at >= ?", Time.current.beginning_of_day).count
      - yesterday = (User.where("created_at >= ?", Time.current.beginning_of_day - 1.day).count) - today
      %em
        (#{number_with_delimiter(today)} today, #{number_with_delimiter(yesterday)} yesterday)

%hr

%h2.mt-4
  Recent
  = link_to "Organizations", admin_organizations_url
= render partial: "/admin/organizations/table"
.row.justify-content-end
  .col-auto
    %p
      = number_with_delimiter(Organization.count)
      Organizations total
      - today = Organization.where("created_at >= ?", Time.current.beginning_of_day).count
      - yesterday = (Organization.where("created_at >= ?", Time.current.beginning_of_day - 1.day).count) - today
      %em
        (#{number_with_delimiter(today)} today, #{number_with_delimiter(yesterday)} yesterday)
