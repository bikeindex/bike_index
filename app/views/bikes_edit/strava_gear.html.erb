<%= form_for @bike, multipart: true, html: { class: 'primary-edit-bike-form' } do |f| %>
  <% if params[:return_to].present? %>
    <%= hidden_field_tag :return_to, params[:return_to] %>
  <% end %>

  <div class="form-well-container container edit-bike-page- <%= @edit_template %>">
    <div class="row">
      <%= render partial: '/bikes_edit/primary_menu', locals: { no_save_button: true } %>

      <div class="col-md-8 form-well">
        <div class="form-wrap">
          <div class="form-well-form-header">
            <h3><%= t(".strava_gear") %></h3>
          </div>

          <div class="related-fields">
            <p class="mb-3"><%= t(".connect_bike_to_strava_gear") %></p>

            <% strava_integration = current_user.strava_integration %>

            <% if strava_integration&.synced? && strava_integration.strava_gears.bikes.any? %>
              <% bike_gear = @bike.strava_gear %>
              <div class="form-group row unnested-field">
                <label class="form-well-label"><%= t(".strava_bike") %></label>

                <div class="form-well-input">
                  <select class="form-control" name="strava_gear_id">
                    <option value="" <%= "selected" if bike_gear.blank? %>><%= t(".none_selected") %></option>

                    <% strava_integration.strava_gears.bikes.each do |gear| %>
                      <option
                        value="<%= gear.strava_gear_id %>"
                        <%= "selected" if bike_gear&.strava_gear_id == gear.strava_gear_id %>
                      >
                        <%= gear.strava_gear_name %>

                        <% if gear.strava_distance_km.present? %>
                          (
                          <%= gear.strava_distance_km %>
                          km)
                        <% end %>
                      </option>
                    <% end %>
                  </select>
                </div>
              </div>
              <% if bike_gear.present? %>
                <div class="mt-3 p-3 bg-light rounded">
                  <p class="mb-1">
                    <strong><%= t(".currently_connected") %></strong>
                  </p>

                  <p class="mb-0"><%= bike_gear.strava_gear_display_name %></p>
                </div>
              <% end %>
              <div class="mt-3">
                <%= hidden_field_tag :edit_template, @edit_template %>
                <%= submit_tag t(".save_strava_gear"), class: 'btn btn-lg btn-primary' %>
              </div>
            <% else %>
              <div class="alert alert-warning">
                <%= t(".strava_not_connected") %>

                <% unless strava_integration.present? %>
                  <%= link_to t(".connect_strava"), my_account_path, class: "alert-link" %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
