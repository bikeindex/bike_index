.container
  .row.first-row
    .col-md-8
      %h1
        Search for bikes
    .col-md-4
      .ad-block.ad468x60
        %h4
          468X60
  .padded-row
    .col-md-8
      = form_tag bikes_path, id: 'bike_search_form', class: 'bike-search-form', method: :get do
        - params[:query] = params[:query].gsub(/,?#,?/,'').gsub(/(\A,|,\z)/, '') if params[:query].present?
        .query-field-wrap
          = text_field_tag :query,                      |
            strip_tags(params[:query]),                 |
            placeholder: 'Search Bike Index',           |
            class: 'form-control query-field',          |
            data: { initial: @selectize_items.to_json }
        .search-button-wrap
          = button_tag(type: 'submit', class: 'searchit btn btn-primary') do
            :plain
              <svg id="search-button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 29"><defs><style>.cls-1,.cls-2{fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:2px;}.cls-2{stroke-linecap:round;}</style></defs><title>searcher</title><circle class="cls-1" cx="10.39" cy="10.39" r="9.39"/><line class="cls-2" x1="17.03" y1="17.03" x2="28" y2="28"/></svg>
        .stolen-search-fields
          = text_field_tag :proximity, params[:proximity], placeholder: 'Anywhere', class: 'form-control stolen-proximity'
          %span
            miles of
          = number_field_tag :proximity_radius, params[:proximity_radius] || 100, placeholder: '100', min: 1, class: 'form-control stolen-radius'
          %span
            within
          = hidden_field_tag :stolen, params[:stolen] || true
          = hidden_field_tag :non_stolen, params[:non_stolen] || ''
          = hidden_field_tag :non_proximity, params[:non_proximity] || ''



    - if params[:stolen].present? && params[:stolen].to_s != 'false'
      - if params[:non_proximity].present? && params[:non_proximity].to_s != 'false'
        - active = 'stolen'
      - else
        - active = 'proximity'
    - else
      - active = 'non_stolen'
    - url = request.original_url.split('bikes?').last
    - url = "#{ENV['BASE_URL']}/api/v2/bikes_search/count?#{url}"
    %nav#search_tabs.bikes-search-type-tabs{ data: {url: url }}
      .container
        %ul
          %li
            %a#proximity_tab{ href: '#', class: ('active' if active == 'proximity')}
              Stolen within
              %span#search_distance
                X
              miles of
              %span#search_location
                you
              %span.count
          %li
            %a#stolen_tab{ href: '#', class: ('active' if active == 'stolen') }
              Stolen anywhere
              %span.count
          %li
            %a#non_stolen_tab{ href: '#', class: ('active' if active == 'non_stolen') }
              Not marked stolen
              %span.count
          / %li
          /   %a.most-recent#stolen_most_recent{ href: '#' }
          /     Most recent stolen bikes near you
        .bottom-cover
              

    - if @bikes.present?

      %ul.bike-boxes
        = render partial: "/bikes/bike_u", collection: @bikes, locals: {target: "show" }

      .container
        .paginate-container-bottom
          = paginate @bikes
          

    - else
      .container
        %h1.no-results
          - if active == 'proximity'
            - desc = "nearby stolen bikes"
          - elsif active == 'non_stolen'
            - desc = 'non-stolen bikes'
          - elsif active == 'stolen'
            - desc = 'bikes stolen anywhere'
          No #{desc}
          - if @secondary_bikes.present?
            exactly match that serial
          - else
            matched your search

    - if @secondary_bikes.present?  
      .container
        %h2.secondary-bikes
          Serial numbers close to
          %em
            #{params[:serial]}

        %ul.bike-boxes
          = render partial: "/bikes/bike_u", collection: @secondary_bikes, locals: {target: "show" }

