= javascript_pack_tag "bikes_search/index"

- stolenness_desc = { 'proximity' => 'nearby stolen', 'non' => 'non-stolen', 'stolen' => 'stolen', 'all' => 'all' }[@interpreted_params[:stolenness]]

.container
  .row.first-row
    .col-md-12
      %h1
        = t(".search_for_stolenness_desc_bikes", stolenness_desc: stolenness_desc)

  .row
    .col-md-12
      = form_tag bikes_path, id: 'bikes_search_form', class: 'bikes-search-form', enforce_utf8: false, method: :get do
        .query-field-wrap.nojs
          = hidden_field_tag :locale, params[:locale] if params[:locale].present?
          - opt_vals = @selected_query_items_options.map { |i| i.is_a?(String) ? [i, i] : [i['text'], i['search_id']]  }
          = select_tag :query_items, options_for_select(opt_vals, selected: opt_vals.map(&:last)), placeholder: t(".search_bike_descriptions"), class: 'form-control query-field', multiple: true
          = text_field_tag :query, params[:query], placeholder: t(".search_bike_descriptions"), class: 'form-control query-field'
          = text_field_tag :serial, params[:serial], placeholder: t(".search_for_serial_number"), class: 'form-control query-field'
        .search-button-wrap
          = button_tag(type: t(".submit"), class: 'searchit btn btn-primary') do
            :plain
              <svg id="search-button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 29 29"><defs><style>.cls-1,.cls-2{fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:2px;}.cls-2{stroke-linecap:round;}</style></defs><title>searcher</title><circle class="cls-1" cx="10.39" cy="10.39" r="9.39"/><line class="cls-2" x1="17.03" y1="17.03" x2="28" y2="28"/></svg>
        .stolen-search-fields{ class: ('currently-hidden' unless params[:stolenness] == 'proximity') }
          = text_field_tag :location, params[:location], placeholder: t(".anywhere"), class: 'form-control stolen-proximity'
          %span
            = t(".miles_of")
          = number_field_tag :distance, @interpreted_params[:distance] || 100, placeholder: '100', min: 1, class: 'form-control stolen-radius'
          %span
            = t(".within")
          = hidden_field_tag :stolenness, params[:stolenness]
      .search-type-tabs
        %ul#stolenness_tabs.nav.nav-tabs{ role: 'tablist' }
          %li#stolenness_tab_proximity.nav-item{ data: { stolenness: 'proximity' } }
            %a.nav-link{ href: '#', class: ('active' if @stolenness == 'proximity'), role: 'tab' }
              = t(".stolen_within")
              %span#search_distance
                X
              = t(".miles_of")
              %span#search_location
                = t(".you")
              %span.count
          %li#stolenness_tab_stolen.nav-item{ data: { stolenness: 'stolen' } }
            %a.nav-link{ href: '#', class: ('active' if @stolenness == 'stolen'), role: 'tab' }
              = t(".stolen_anywhere")
              %span.count
          %li#stolenness_tab_non.nav-item{ data: { stolenness: 'non' } }
            %a.nav-link{ href: '#', class: ('active' if @stolenness == 'non'), role: 'tab' }
              = t(".not_marked_stolen")
              %span.count
          %li#stolenness_tab_all.nav-item{ data: { stolenness: 'all' } }
            %a.nav-link{ href: '#', class: ('active' if @stolenness == 'all'), role: 'tab' }
              = t(".all")
  .row
    .col-md-12
      - if @bikes.present?
        %ul.bike-boxes
          = render partial: 'bikes/bike', collection: @bikes, as: :bike
        .paginate-container.paginate-container-bottom
          = paginate @bikes

      - else
        %h3.no-exact-results
          = t(".no_bikes_matched")

  - if @interpreted_params[:serial].present?
    .row
      .col-md-12
        %h3.secondary-matches#js-partial-serial-search-header
          .loading.d-none= t(".searching_for_partial_matches")
          .loaded.d-none= t(".with_partial_serial_numbers_html", stolenness: stolenness_desc, serial: params[:serial])
          .loaded-none.no-exact-results.d-none= t(".no_partial_matches_found")
        #js-partial-serial-search

    .row
      .col-md-12
        %h3.secondary-matches#js-close-serial-search-header
          .loading.d-none= t(".searching_for_near_matches")
          .loaded.d-none= t(".with_close_serial_numbers_html", stolenness: stolenness_desc, serial: params[:serial])
          .loaded-none.no-exact-results.d-none= t(".no_near_matches_found")
        #js-close-serial-search

    .row
      .col-md-12
        %h3.secondary-matches#js-external-registry-search-header
          .loading.d-none= t(".searching_external_registries")
          .loaded.d-none= t(".external_matches_found")
          .loaded-none.no-exact-results.d-none= t(".no_external_matches_found")
        #js-external-registry-search

    .col-md-4.ad-col
      .ad-block#right300x600

:javascript
  window.interpreted_params = #{@interpreted_params.to_json};
  window.bike_placeholder_image = "#{bike_placeholder_image_path}";

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
