:plain
  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

%html{ xmlns: "http://www.w3.org/1999/xhtml" }
  %head
    %meta{charset: "utf-8"}
    %meta{"http-equiv" => "X-UA-Compatible", content: "text/html; charset=UTF-8"}
    = wicked_pdf_stylesheet_link_tag "registration_pdf"
    <link href='https://fonts.googleapis.com/css?family=Rambla:400' rel='stylesheet' type='text/css'>

    %title
      - tit = ''
      - tit += "#{@bike.year} " if @bike.year.present?
      - tit += "#{@bike.frame_model} by " if @bike.frame_model.present?
      = tit + @bike.mnfg_name

%body
  %header
    - if @bike.manufacturer.logo && @bike.manufacturer.logo.url != "https://files.bikeindex.org/blank.png"
      .mnfg-logo
        %img{ src: @bike.manufacturer.logo }
    - if @bike.public_images.present?
      - if Rails.env.development?
        %img.bike-photo{ src: root_url + @bike.public_images.first.image_url }
      - else
        %img.bike-photo{ src: @bike.public_images.first.image_url }
    - elsif @bike.stock_photo_url.present?
      %img.bike-photo{ src: @bike.stock_photo_url }
    %h1
      - if @bike.status_stolen?
        %span.stolen-color
          = translate_with_args(".stolen")
      = bike_title_html(@bike)

  - if @stolen_record.present?
    .stolen-container
      - if @stolen_record.theft_description.present?
        %p
          %em
            = translate_with_args(".description_of_theft")
          = @stolen_record.theft_description.truncate(300)
      .bike-details
        %table.table.table-striped
          %tbody
            %tr
              %td.td-title
                = translate_with_args(".date_stolen")
              %td
                = @stolen_record.date_stolen.strftime("time.format.short_with_hour")
            %tr
              %td.td-title
                = translate_with_args(".location")
              %td
                = @stolen_record.address

      .bike-details
        %table.table.table-striped
          %tbody
            - if @stolen_record.phone.present?
              %tr
                %td.td-title
                  = translate_with_args(".owner_phone")
                %td
                  = phone_link(@stolen_record.phone, class: "phone-number-link")
            - if @stolen_record.police_report_number.present?
              %tr
                %td.td-title
                  = translate_with_args(".police_report")
                %td
                  = @stolen_record.police_report_number
            - if @stolen_record.police_report_department.present?
              %tr
                %td.td-title
                  = translate_with_args(".department")
                %td
                  = @stolen_record.police_report_department
  - if @bike.description.present?
    .description
      %p
        %em
          = translate_with_args(".bike_description")
        - if @bike.status_stolen?
          = @bike.description.truncate(500)
        - else
          = @bike.description
  .details-container
    .bike-details
      %table.table.table-striped
        %tbody
          %tr
            %td.td-title
              = translate_with_args(".registered")
            %td.convertTime
              = @bike.created_at.strftime("time.format.convert_time")
              = translate_with_args(".to")
              - if @bike.owner.present? && @bike.owner.name.present?
                = @bike.owner.name
              - else
                = @bike.owner_email
          %tr
            %td.td-title
              = translate_with_args(".bike_serial")
            %td
              = @bike.serial_display
          %tr
            %td.td-title
              = translate_with_args(".manufacturer")
            %td
              = @bike.mnfg_name
          - if @bike.frame_model.present?
            %tr
              %td.td-title
                = translate_with_args(".model")
              %td
                = @bike.frame_model
          - unless @bike.status_stolen? and @stolen_record.present?
            - if @bike.frame_size.present?
              %tr
                %td.td-title
                  = translate_with_args(".frame_size")
                %td
                  = @bike.frame_size
          - if @bike.paint.present?
            %tr
              %td.td-title
                = translate_with_args(".paint")
              %td
                = @bike.paint.name
          - else
            %tr
              %td.td-title
                = translate_with_args(".color").pluralize(@bike.frame_colors.count)
              %td
                = @bike.frame_colors.to_sentence
          - unless @bike.status_stolen? and @stolen_record.present?
            - if @bike.front_gear_type.present?
              %tr
                %td.td-title
                  = translate_with_args(".front_gears")
                %td
                  = @bike.front_gear_type.name
            - if @bike.rear_gear_type.present?
              %tr
                %td.td-title
                  = translate_with_args(".rear_gears")
                %td
                  = @bike.rear_gear_type.name
                  = translate_with_args(".with_coaster_brake") if @bike.coaster_brake
                  - if @bike.components.where(ctype_id: Ctype.find_by_name('hub').id).present?
                    - hubs = @bike.components.where(ctype_id: Ctype.find_by_name('hub').id)
                    - if hubs.where(rear: true)
                      - r_hub = hubs.where(rear: true).first
                      - if r_hub.present?
                        - model_name = r_hub.component_model
                        - mfg_name = r_hub.mnfg_name
                        = "(#{model_name} #{t('.by')} #{mfg_name})"


    .bike-details
      - unless @bike.status_stolen? and @stolen_record.present?
        %table.table.table-striped
          %tbody
            %tr
              %td.td-title
                = translate_with_args(".front_wheel")
              %td
                = @bike.front_wheel_size.name if @bike.front_wheel_size.present?
                = translate_with_args(".with")
                - if @bike.front_tire_narrow
                  = translate_with_args(".narrow_tires")
                - else
                  = translate_with_args(".wide_tires")
            - if @bike.rear_wheel_size.present?
              %tr
                %td.td-title
                  = translate_with_args(".rear_wheel")
                %td
                  = @bike.rear_wheel_size.name
                  = translate_with_args(".with")
                  - if @bike.rear_tire_narrow
                    = translate_with_args(".narrow_tires")
                  - else
                    = translate_with_args(".wide_tires")
            - if @bike.components.where(ctype_id: Ctype.find_by_name('saddle').id).present?
              %tr
                %td.td-title
                  = translate_with_args(".saddle")
                %td
                  - seat = @bike.components.where(ctype_id: Ctype.find_by_name('saddle').id).first
                  = seat.component_model if seat.component_model.present?
                  - if seat.manufacturer.present?
                    = translate_with_args(".by")
                    = seat.manufacturer.name
                  = seat.description


      .index-block{ class: ('stolen' if @bike.status_stolen?) }
        .logo-block
          %img{ src: "https://files.bikeindex.org/logo.png" }
        .index-text
          %h2
            = translate_with_args(".registration")
          %h3
            = translate_with_args(".printout")
          %p
            = translate_with_args(".online")
            @
            = link_to translate_with_args(".bikeindex_org", bike_path: bike_path(@bike)), bike_url(@bike)
