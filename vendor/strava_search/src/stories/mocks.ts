import type { StoredActivity, StoredGear } from '../services/database';
import babyHawkCassette from '../testing/cassettes/baby_hawk.json';

export const mockGear: StoredGear[] = [
  {
    id: 'b12345',
    primary: true,
    name: 'Trek Domane SL5',
    distance: 5234567,
    brand_name: 'Trek',
    model_name: 'Domane SL5',
    resource_state: 2,
    athleteId: 12345,
  },
  {
    id: 'g67890',
    primary: false,
    name: 'Nike Pegasus 40',
    distance: 823456,
    brand_name: 'Nike',
    model_name: 'Pegasus 40',
    resource_state: 2,
    athleteId: 12345,
  },
  {
    id: 'b11111',
    primary: false,
    name: 'Canyon Grail',
    distance: 1234567,
    brand_name: 'Canyon',
    model_name: 'Grail CF SL',
    resource_state: 2,
    athleteId: 12345,
  },
];

export const mockActivities: StoredActivity[] = [
  {
    id: 1001,
    name: 'Morning Run in Central Park',
    description: 'Beautiful morning run through the park. Perfect weather!',
    distance: 8045.5,
    moving_time: 2400,
    elapsed_time: 2520,
    total_elevation_gain: 45,
    type: 'Run',
    sport_type: 'Run',
    start_date: '2024-01-15T12:30:00Z',
    start_date_local: '2024-01-15T07:30:00Z',
    timezone: '(GMT-05:00) America/New_York',
    utc_offset: -18000,
    location_city: 'New York',
    location_state: 'New York',
    location_country: 'United States',
    achievement_count: 3,
    kudos_count: 15,
    comment_count: 2,
    athlete_count: 1,
    photo_count: 0,
    trainer: false,
    commute: false,
    manual: false,
    private: false,
    visibility: 'everyone',
    flagged: false,
    gear_id: 'g67890',
    average_speed: 3.35,
    max_speed: 4.2,
    has_heartrate: true,
    average_heartrate: 152,
    max_heartrate: 175,
    heartrate_opt_out: false,
    display_hide_heartrate_option: false,
    pr_count: 2,
    total_photo_count: 0,
    has_kudoed: false,
    suffer_score: 45,
    calories: 523,
    athleteId: 12345,
    syncedAt: Date.now(),
  },
  {
    id: 1002,
    name: 'Weekend Century Ride',
    description: 'First century of the year! Tough climbs but amazing views.',
    distance: 161234.5,
    moving_time: 18000,
    elapsed_time: 21600,
    total_elevation_gain: 1523,
    type: 'Ride',
    sport_type: 'Ride',
    start_date: '2024-01-14T14:00:00Z',
    start_date_local: '2024-01-14T09:00:00Z',
    timezone: '(GMT-05:00) America/New_York',
    utc_offset: -18000,
    location_city: 'Nyack',
    location_state: 'New York',
    location_country: 'United States',
    achievement_count: 8,
    kudos_count: 42,
    comment_count: 5,
    athlete_count: 3,
    photo_count: 4,
    trainer: false,
    commute: false,
    manual: false,
    private: false,
    visibility: 'everyone',
    flagged: false,
    gear_id: 'b12345',
    average_speed: 8.96,
    max_speed: 15.5,
    average_watts: 185,
    weighted_average_watts: 205,
    kilojoules: 3330,
    device_watts: true,
    has_heartrate: true,
    average_heartrate: 145,
    max_heartrate: 178,
    heartrate_opt_out: false,
    display_hide_heartrate_option: false,
    pr_count: 5,
    total_photo_count: 4,
    has_kudoed: false,
    suffer_score: 187,
    calories: 3245,
    athleteId: 12345,
    syncedAt: Date.now(),
  },
  {
    id: 1003,
    name: 'Zwift - Volcano Climb',
    description: undefined,
    distance: 32500,
    moving_time: 3600,
    elapsed_time: 3600,
    total_elevation_gain: 650,
    type: 'VirtualRide',
    sport_type: 'VirtualRide',
    start_date: '2024-01-13T23:00:00Z',
    start_date_local: '2024-01-13T18:00:00Z',
    timezone: '(GMT-05:00) America/New_York',
    utc_offset: -18000,
    achievement_count: 0,
    kudos_count: 5,
    comment_count: 0,
    athlete_count: 1,
    photo_count: 0,
    trainer: true,
    commute: false,
    manual: false,
    private: false,
    visibility: 'everyone',
    flagged: false,
    gear_id: 'b12345',
    average_speed: 9.03,
    max_speed: 12.5,
    average_watts: 220,
    weighted_average_watts: 245,
    kilojoules: 792,
    device_watts: true,
    has_heartrate: true,
    average_heartrate: 158,
    max_heartrate: 182,
    heartrate_opt_out: false,
    display_hide_heartrate_option: false,
    pr_count: 0,
    total_photo_count: 0,
    has_kudoed: false,
    suffer_score: 95,
    calories: 756,
    athleteId: 12345,
    syncedAt: Date.now(),
  },
  {
    id: 1004,
    name: 'Easy Recovery Swim',
    distance: 2000,
    moving_time: 2400,
    elapsed_time: 3000,
    total_elevation_gain: 0,
    type: 'Swim',
    sport_type: 'Swim',
    start_date: '2024-01-12T17:00:00Z',
    start_date_local: '2024-01-12T12:00:00Z',
    timezone: '(GMT-05:00) America/New_York',
    utc_offset: -18000,
    location_city: 'Brooklyn',
    location_state: 'New York',
    location_country: 'United States',
    achievement_count: 0,
    kudos_count: 8,
    comment_count: 0,
    athlete_count: 1,
    photo_count: 0,
    trainer: false,
    commute: false,
    manual: false,
    private: false,
    visibility: 'everyone',
    flagged: false,
    average_speed: 0.83,
    max_speed: 1.2,
    has_heartrate: false,
    heartrate_opt_out: false,
    display_hide_heartrate_option: false,
    pr_count: 0,
    total_photo_count: 0,
    has_kudoed: false,
    calories: 450,
    athleteId: 12345,
    syncedAt: Date.now(),
  },
  {
    id: 1005,
    name: 'Trail Hike at Bear Mountain',
    description: 'Great winter hike with amazing views of the Hudson Valley.',
    distance: 12500,
    moving_time: 10800,
    elapsed_time: 14400,
    total_elevation_gain: 520,
    type: 'Hike',
    sport_type: 'Hike',
    start_date: '2024-01-11T15:00:00Z',
    start_date_local: '2024-01-11T10:00:00Z',
    timezone: '(GMT-05:00) America/New_York',
    utc_offset: -18000,
    location_city: 'Bear Mountain',
    location_state: 'New York',
    location_country: 'United States',
    achievement_count: 1,
    kudos_count: 23,
    comment_count: 3,
    athlete_count: 2,
    photo_count: 8,
    trainer: false,
    commute: false,
    manual: false,
    private: false,
    visibility: 'everyone',
    flagged: false,
    average_speed: 1.16,
    max_speed: 2.1,
    has_heartrate: true,
    average_heartrate: 125,
    max_heartrate: 155,
    heartrate_opt_out: false,
    display_hide_heartrate_option: false,
    pr_count: 0,
    total_photo_count: 8,
    has_kudoed: false,
    suffer_score: 65,
    calories: 890,
    athleteId: 12345,
    syncedAt: Date.now(),
  },
];

// Extract activity data from baby_hawk.json cassette
const babyHawkResponse = babyHawkCassette.interactions[0].response.body as Record<string, unknown>;
const babyHawkSegments = babyHawkResponse.segment_efforts as Array<{ segment: { city: string | null; state: string | null; country: string | null } }> | undefined;
const firstSegmentWithLocation = babyHawkSegments?.find(s => s.segment?.city || s.segment?.state);

// Extract all unique locations from segment efforts
const segmentCities = new Set<string>();
const segmentStates = new Set<string>();
const segmentCountries = new Set<string>();
babyHawkSegments?.forEach((effort) => {
  if (effort.segment?.city) segmentCities.add(effort.segment.city);
  if (effort.segment?.state) segmentStates.add(effort.segment.state);
  if (effort.segment?.country) segmentCountries.add(effort.segment.country);
});

export const babyHawkActivity: StoredActivity = {
  id: babyHawkResponse.id as number,
  name: babyHawkResponse.name as string,
  description: (babyHawkResponse.description as string) || undefined,
  distance: babyHawkResponse.distance as number,
  moving_time: babyHawkResponse.moving_time as number,
  elapsed_time: babyHawkResponse.elapsed_time as number,
  total_elevation_gain: babyHawkResponse.total_elevation_gain as number,
  type: babyHawkResponse.type as string,
  sport_type: babyHawkResponse.sport_type as string,
  start_date: babyHawkResponse.start_date as string,
  start_date_local: babyHawkResponse.start_date_local as string,
  timezone: babyHawkResponse.timezone as string,
  utc_offset: babyHawkResponse.utc_offset as number,
  // Derive location from segment efforts when activity location is null
  location_city: (babyHawkResponse.location_city as string | null) ?? firstSegmentWithLocation?.segment?.city ?? undefined,
  location_state: (babyHawkResponse.location_state as string | null) ?? firstSegmentWithLocation?.segment?.state ?? undefined,
  location_country: (babyHawkResponse.location_country as string | null) ?? firstSegmentWithLocation?.segment?.country ?? undefined,
  // All unique locations from segment efforts
  segment_cities: segmentCities.size > 0 ? Array.from(segmentCities).sort() : undefined,
  segment_states: segmentStates.size > 0 ? Array.from(segmentStates).sort() : undefined,
  segment_countries: segmentCountries.size > 0 ? Array.from(segmentCountries).sort() : undefined,
  achievement_count: babyHawkResponse.achievement_count as number,
  kudos_count: babyHawkResponse.kudos_count as number,
  comment_count: babyHawkResponse.comment_count as number,
  athlete_count: babyHawkResponse.athlete_count as number,
  photo_count: babyHawkResponse.photo_count as number,
  trainer: babyHawkResponse.trainer as boolean,
  commute: babyHawkResponse.commute as boolean,
  manual: babyHawkResponse.manual as boolean,
  private: babyHawkResponse.private as boolean,
  visibility: babyHawkResponse.visibility as string,
  flagged: babyHawkResponse.flagged as boolean,
  gear_id: babyHawkResponse.gear_id as string,
  average_speed: babyHawkResponse.average_speed as number,
  max_speed: babyHawkResponse.max_speed as number,
  average_watts: babyHawkResponse.average_watts as number,
  device_watts: babyHawkResponse.device_watts as boolean,
  kilojoules: babyHawkResponse.kilojoules as number,
  has_heartrate: babyHawkResponse.has_heartrate as boolean,
  average_heartrate: babyHawkResponse.average_heartrate as number,
  max_heartrate: babyHawkResponse.max_heartrate as number,
  heartrate_opt_out: babyHawkResponse.heartrate_opt_out as boolean,
  display_hide_heartrate_option: babyHawkResponse.display_hide_heartrate_option as boolean,
  pr_count: babyHawkResponse.pr_count as number,
  total_photo_count: babyHawkResponse.total_photo_count as number,
  has_kudoed: babyHawkResponse.has_kudoed as boolean,
  suffer_score: babyHawkResponse.suffer_score as number,
  calories: babyHawkResponse.calories as number,
  device_name: babyHawkResponse.device_name as string | undefined,
  hide_from_home: babyHawkResponse.hide_from_home as boolean | undefined,
  photos: babyHawkResponse.photos as {
    primary?: {
      unique_id: string;
      urls: { '100': string; '600': string };
      source: number;
      media_type: number;
    };
    use_primary_photo: boolean;
    count: number;
  } | undefined,
  athleteId: (babyHawkResponse.athlete as { id: number }).id,
  syncedAt: Date.now(),
};

const babyHawkGearResponse = babyHawkResponse.gear as Record<string, unknown>;
export const babyHawkGear: StoredGear = {
  id: babyHawkGearResponse.id as string,
  primary: babyHawkGearResponse.primary as boolean,
  name: babyHawkGearResponse.name as string,
  distance: babyHawkGearResponse.distance as number,
  resource_state: babyHawkGearResponse.resource_state as number,
  athleteId: (babyHawkResponse.athlete as { id: number }).id,
};

export const mockAthlete = {
  id: 12345,
  username: 'athlete123',
  firstname: 'John',
  lastname: 'Doe',
  city: 'New York',
  state: 'New York',
  country: 'United States',
  profile: 'https://dgalywyr863hv.cloudfront.net/pictures/athletes/2430215/2807433/6/large.jpg',
  profile_medium: 'https://dgalywyr863hv.cloudfront.net/pictures/athletes/2430215/2807433/6/medium.jpg',
};

export const mockSyncState = {
  athleteId: 12345,
  lastSyncedAt: Date.now() - 1000 * 60 * 30, // 30 minutes ago
  oldestActivityDate: '2020-01-01T00:00:00Z',
  isInitialSyncComplete: true,
};
